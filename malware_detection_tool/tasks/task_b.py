import os
from datetime import datetime
from tasks.task_a import detect_malware  # Absolute import from tasks
from utils.hashing import create_hashes  # Absolute import from utils
from utils.file_utils import quarantine_file

def scan_directory(directory, signatures, log_file):
    print(f"Scanning directory: {directory}")
    with open(log_file, 'w') as log:
        for root, _, files in os.walk(directory):
            for file in files:
                file_path = os.path.join(root, file)
                with open(file_path, 'rb') as f:
                    data = f.read().decode(errors='ignore')
                    if detect_malware(signatures, data):
                        log.write(f"{datetime.now()} - Malware detected: {file} in {file_path}\n")
                        quarantine_file(file_path)
                        print(f"Quarantined file: {file_path}")
                    else:
                        print(f"File {file} is clean.")
    print(f"Scan completed. Log saved to {log_file}")
